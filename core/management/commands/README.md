# Команды управления мероприятиями

В этой директории содержатся команды управления для системы мероприятий Ticketon.

## Команда удаления мероприятий

Команда `purge_events.py` предназначена для автоматического удаления мероприятий старше одного года и отправки уведомлений по электронной почте за неделю до удаления.

### Использование

Вы можете запустить команду вручную:

```bash
# Проверить, что будет удалено и о чем будут отправлены уведомления, без выполнения действий
python manage.py purge_events --dry-run

# Отправить только уведомления без удаления
python manage.py purge_events --notify-only

# Выполнить фактическое удаление и отправить уведомления
python manage.py purge_events
```

### Настройка автоматического выполнения

Для автоматического выполнения следует настроить cron-задание (Linux/Mac) или запланированную задачу (Windows).

#### Cron-задание (Linux/Mac)

Добавьте следующую строку в свой crontab:

```
# Запускать каждый день в 2:00
0 2 * * * cd /path/to/tiketon && /path/to/python manage.py purge_events >> /path/to/logs/purge_events.log 2>&1
```

#### Запланированная задача (Windows)

1. Откройте Планировщик заданий
2. Создайте Простую задачу
3. Установите триггер на ежедневный запуск в 2:00
4. Установите действие запуска программы:
   - Программа/скрипт: `C:\path\to\python.exe`
   - Добавить аргументы: `C:\path\to\tiketon\manage.py purge_events`
   - Начальная папка: `C:\path\to\tiketon`

### Конфигурация окружения

Убедитесь, что заданы следующие переменные окружения:

- `ADMIN_EMAIL`: Адрес электронной почты, на который будут приходить уведомления об удаленных мероприятиях
- `EMAIL_HOST`: Имя хоста SMTP-сервера
- `EMAIL_PORT`: Порт SMTP-сервера
- `EMAIL_HOST_USER`: Имя пользователя SMTP
- `EMAIL_HOST_PASSWORD`: Пароль SMTP
- `EMAIL_USE_TLS`: Использовать ли TLS (True/False)
- `DEFAULT_FROM_EMAIL`: Адрес "от кого" для писем с уведомлениями 