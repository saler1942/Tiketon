{% extends 'base.html' %}

{% block title %}–ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è | Freedom Ticketon | TEAM SYRYM{% endblock %}

{% block content %}
<div class="flex justify-between items-center mb-3" style="flex-wrap: wrap; gap: 1rem;">
    <h1>–ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è</h1>
    <div class="flex gap-2" style="flex-wrap: wrap;">
        <a href="{% url 'event_create' %}" class="btn btn-primary">–î–æ–±–∞–≤–∏—Ç—å –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ</a>
        <a href="{% url 'all_scanners_list' %}" class="btn btn-secondary">–°–ø–∏—Å–æ–∫ —Å–∫–∞–Ω–µ—Ä–æ–≤</a>
        <div class="dropdown" style="display: inline-block; position: relative;">
            <button class="btn btn-info dropdown-btn">–°–∏—Å—Ç–µ–º–∞</button>
            <div class="dropdown-content" style="position: absolute; right: 0; min-width: 220px; z-index: 10; background: white; border: 1px solid #ddd; border-radius: 4px; box-shadow: 0 2px 5px rgba(0,0,0,0.2);">
                <a href="{% url 'purge_settings' %}" style="display: block; padding: 8px 12px; text-decoration: none; color: #333;">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É–¥–∞–ª–µ–Ω–∏—è</a>
                <a href="{% url 'send_test_notification' %}" style="display: block; padding: 8px 12px; text-decoration: none; color: #333;">–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ</a>
                {% if user.is_staff %}
                <a href="{% url 'notification_logs' %}" style="display: block; padding: 8px 12px; text-decoration: none; color: #333;">–ñ—É—Ä–Ω–∞–ª —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π</a>
                {% endif %}
            </div>
        </div>
        {% if user.is_staff %}
        <a href="{% url 'admin:index' %}" class="btn btn-secondary">–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</a>
        {% endif %}
        <a href="{% url 'scanner_certificates' %}" class="btn btn-success">–°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã</a>
        <!-- <a href="{% url 'export_all_events' %}" class="btn btn-secondary">–≠–∫—Å–ø–æ—Ä—Ç –≤ Excel</a> -->
    </div>
</div>

<form method="get" class="card mb-3 table-responsive" style="display: flex; flex-wrap: wrap; gap: 1rem; align-items: end;">
    <div style="flex:1; min-width: 180px; width: 100%;">
        <label for="q">–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é</label>
        <input type="text" id="q" name="q" class="form-control" value="{{ q|default:'' }}" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è">
    </div>
    <div style="min-width: 150px; width: calc(50% - 0.5rem);">
        <label for="date_from">–î–∞—Ç–∞ –æ—Ç</label>
        <input type="date" id="date_from" name="date_from" class="form-control" value="{{ date_from|default:'' }}">
    </div>
    <div style="min-width: 150px; width: calc(50% - 0.5rem);">
        <label for="date_to">–î–∞—Ç–∞ –¥–æ</label>
        <input type="date" id="date_to" name="date_to" class="form-control" value="{{ date_to|default:'' }}">
    </div>
    <div style="flex:1; min-width: 180px; width: 100%;">
        <label for="leader">–¢–∏–º–ª–∏–¥–µ—Ä</label>
        <input type="text" id="leader" name="leader" class="form-control" value="{{ leader|default:'' }}" placeholder="–ò–º—è –∏–ª–∏ —Ñ–∞–º–∏–ª–∏—è">
    </div>
    <div style="min-width: 120px; width: 100%;">
        <button type="submit" class="btn btn-primary" style="width: 100%;">–ù–∞–π—Ç–∏</button>
    </div>
</form>

{% if events %}
<div class="card table-responsive">
    {% for event in events %}
    <div class="event-item {% if not forloop.last %}mb-3{% endif %}" style="padding: 1rem; border-bottom: 1px solid var(--gray-color); {% if forloop.last %}border-bottom: none;{% endif %}">
        <div style="display: flex; flex-wrap: wrap; justify-content: space-between; align-items: flex-start; gap: 1rem;">
            <div style="flex: 1; min-width: 200px;">
                <h2 class="mb-1" style="word-break: break-word;">{{ event.name }}</h2>
                <div class="text-sm" style="color: #666;">
                    <div style="margin-bottom: 0.3rem;">–î–∞—Ç–∞: {{ event.date }}</div>
                    <div style="margin-bottom: 0.3rem;">–¢–∏–º–ª–∏–¥–µ—Ä: {{ event.created_by.first_name }} {{ event.created_by.last_name }}</div>
                    <div>–¢—Ä–µ–±—É–µ—Ç—Å—è —Å–∫–∞–Ω–µ—Ä–æ–≤: {{ event.max_scanners }}</div>
                </div>
            </div>
            <a href="{% url 'event_edit' event.id %}" class="btn btn-secondary" style="align-self: flex-start;">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</a>
        </div>
    </div>
    {% endfor %}
</div>

<div class="flex justify-center mt-3" style="flex-wrap: wrap;">
    <nav aria-label="–ü–∞–≥–∏–Ω–∞—Ü–∏—è" style="width: 100%; max-width: 400px;">
        <ul class="pagination" style="display: flex; gap: 0.5rem; list-style: none; padding: 0; justify-content: center; flex-wrap: wrap;">
            {% if page_obj.has_previous %}
                <li><a href="?{% if q %}q={{ q }}&{% endif %}{% if date_from %}date_from={{ date_from }}&{% endif %}{% if date_to %}date_to={{ date_to }}&{% endif %}{% if leader %}leader={{ leader }}&{% endif %}page={{ page_obj.previous_page_number }}" class="btn btn-secondary">&laquo; –ù–∞–∑–∞–¥</a></li>
            {% endif %}
            <li style="padding: 0.5rem 1rem; text-align: center;">–°—Ç—Ä. {{ page_obj.number }} –∏–∑ {{ page_obj.paginator.num_pages }}</li>
            {% if page_obj.has_next %}
                <li><a href="?{% if q %}q={{ q }}&{% endif %}{% if date_from %}date_from={{ date_from }}&{% endif %}{% if date_to %}date_to={{ date_to }}&{% endif %}{% if leader %}leader={{ leader }}&{% endif %}page={{ page_obj.next_page_number }}" class="btn btn-secondary">–í–ø–µ—Ä—ë–¥ &raquo;</a></li>
            {% endif %}
        </ul>
    </nav>
</div>
{% else %}
<div class="card" style="text-align: center; padding: 3rem 1rem;">
    <div style="font-size: 3rem; color: #ccc; margin-bottom: 1rem;">üìÖ</div>
    <h2>–ù–µ—Ç –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π –ø–æ –∑–∞–¥–∞–Ω–Ω—ã–º —É—Å–ª–æ–≤–∏—è–º</h2>
    <p class="mb-3" style="color: #666;">–ò–∑–º–µ–Ω–∏—Ç–µ —Ñ–∏–ª—å—Ç—Ä—ã –∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤–æ–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ</p>
</div>
{% endif %}
{% endblock %}

{% block extra_js %}
<style>
.dropdown {
    position: relative;
    display: inline-block;
}
.dropdown-btn {
    display: inline-block;
    cursor: pointer;
}
.dropdown-content {
    display: none;
}
.dropdown:hover .dropdown-content {
    display: block;
}
</style>
{% endblock %} 