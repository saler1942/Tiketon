{% extends 'base.html' %}

{% block title %}–ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è | –¢–∏–∫–µ—Ç–æ–Ω{% endblock %}

{% block content %}
<div class="flex justify-between items-center mb-3">
    <h1>–ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è</h1>
    <div class="flex gap-2">
        {% if user.is_staff %}
        <a href="{% url 'admin:index' %}" class="btn btn-secondary">–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</a>
        {% endif %}
        <a href="{% url 'export_all_events' %}" class="btn btn-secondary">–≠–∫—Å–ø–æ—Ä—Ç –≤—Å–µ—Ö –≤ Excel</a>
        <a href="{% url 'event_create' %}" class="btn btn-primary">+ –ù–æ–≤–æ–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ</a>
    </div>
</div>

<form method="get" class="card mb-3" style="display: flex; flex-wrap: wrap; gap: 1rem; align-items: end;">
    <div style="flex:1; min-width: 180px;">
        <label for="q">–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é</label>
        <input type="text" id="q" name="q" class="form-control" value="{{ q|default:'' }}" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è">
    </div>
    <div style="min-width: 150px;">
        <label for="date_from">–î–∞—Ç–∞ –æ—Ç</label>
        <input type="date" id="date_from" name="date_from" class="form-control" value="{{ date_from|default:'' }}">
    </div>
    <div style="min-width: 150px;">
        <label for="date_to">–î–∞—Ç–∞ –¥–æ</label>
        <input type="date" id="date_to" name="date_to" class="form-control" value="{{ date_to|default:'' }}">
    </div>
    <div style="flex:1; min-width: 180px;">
        <label for="leader">–¢–∏–º–ª–∏–¥–µ—Ä</label>
        <input type="text" id="leader" name="leader" class="form-control" value="{{ leader|default:'' }}" placeholder="–ò–º—è –∏–ª–∏ —Ñ–∞–º–∏–ª–∏—è">
    </div>
    <div style="min-width: 120px;">
        <button type="submit" class="btn btn-primary" style="width: 100%;">–ù–∞–π—Ç–∏</button>
    </div>
</form>

{% if events %}
<div class="card">
    {% for event in events %}
    <div class="event-item {% if not forloop.last %}mb-3{% endif %}" style="padding: 1rem; border-bottom: 1px solid var(--gray-color); {% if forloop.last %}border-bottom: none;{% endif %}">
        <div class="flex justify-between items-center">
            <div>
                <h2 class="mb-1">{{ event.name }}</h2>
                <div class="text-sm" style="color: #666;">
                    <span class="mr-1">–î–∞—Ç–∞: {{ event.date }}</span>
                    <span class="mr-1">‚Ä¢</span>
                    <span>–¢–∏–º–ª–∏–¥–µ—Ä: {{ event.leader.first_name }} {{ event.leader.last_name }}</span>
                    <span class="mr-1">‚Ä¢</span>
                    <span>–¢—Ä–µ–±—É–µ—Ç—Å—è –≤–æ–ª–æ–Ω—Ç—ë—Ä–æ–≤: {{ event.volunteers_required }}</span>
                </div>
            </div>
            <a href="{% url 'event_edit' event.id %}" class="btn btn-secondary">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</a>
        </div>
    </div>
    {% endfor %}
</div>

<div class="flex justify-center mt-3">
    <nav aria-label="–ü–∞–≥–∏–Ω–∞—Ü–∏—è">
        <ul class="pagination" style="display: flex; gap: 0.5rem; list-style: none; padding: 0;">
            {% if page_obj.has_previous %}
                <li><a href="?{% if q %}q={{ q }}&{% endif %}{% if date_from %}date_from={{ date_from }}&{% endif %}{% if date_to %}date_to={{ date_to }}&{% endif %}{% if leader %}leader={{ leader }}&{% endif %}page={{ page_obj.previous_page_number }}" class="btn btn-secondary">&laquo; –ù–∞–∑–∞–¥</a></li>
            {% endif %}
            <li style="padding: 0.5rem 1rem;">–°—Ç—Ä. {{ page_obj.number }} –∏–∑ {{ page_obj.paginator.num_pages }}</li>
            {% if page_obj.has_next %}
                <li><a href="?{% if q %}q={{ q }}&{% endif %}{% if date_from %}date_from={{ date_from }}&{% endif %}{% if date_to %}date_to={{ date_to }}&{% endif %}{% if leader %}leader={{ leader }}&{% endif %}page={{ page_obj.next_page_number }}" class="btn btn-secondary">–í–ø–µ—Ä—ë–¥ &raquo;</a></li>
            {% endif %}
        </ul>
    </nav>
</div>
{% else %}
<div class="card" style="text-align: center; padding: 3rem 1rem;">
    <div style="font-size: 3rem; color: #ccc; margin-bottom: 1rem;">üìÖ</div>
    <h2>–ù–µ—Ç –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π –ø–æ –∑–∞–¥–∞–Ω–Ω—ã–º —É—Å–ª–æ–≤–∏—è–º</h2>
    <p class="mb-3" style="color: #666;">–ò–∑–º–µ–Ω–∏—Ç–µ —Ñ–∏–ª—å—Ç—Ä—ã –∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤–æ–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ</p>
    <a href="{% url 'event_create' %}" class="btn btn-primary">–°–æ–∑–¥–∞—Ç—å –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ</a>
</div>
{% endif %}
{% endblock %} 